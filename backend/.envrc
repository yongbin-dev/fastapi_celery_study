# .envrc - direnv μλ™ ν™κ²½ μ„¤μ •
# μ΄ νμΌμ€ λ””λ ‰ν† λ¦¬ μ§„μ…μ‹ μλ™μΌλ΅ μ‹¤ν–‰λ©λ‹λ‹¤.

# PS1 κ²½κ³  λ°©μ§€
unset PS1

# κ°€μƒν™κ²½ κ°•μ  μ„¤μ •
if [ ! -d ".venv" ]; then
    echo "π”§ κ°€μƒν™κ²½μ΄ μ—†μµλ‹λ‹¤. μλ™μΌλ΅ μƒμ„±ν•©λ‹λ‹¤..."
    poetry config virtualenvs.in-project true
    poetry config virtualenvs.create true
    poetry install
    echo "β… κ°€μƒν™κ²½ μƒμ„± μ™„λ£!"
fi

# κ°€μƒν™κ²½ κ°•μ  ν™μ„±ν™”
if [ -d ".venv" ]; then
    source ./.venv/bin/activate
    echo "π κ°€μƒν™κ²½ κ°•μ  ν™μ„±ν™”: $(basename $VIRTUAL_ENV)"
else
    echo "β κ°€μƒν™κ²½ ν™μ„±ν™”μ— μ‹¤ν¨ν–μµλ‹λ‹¤."
    exit 1
fi

# κ°€μƒν™κ²½ ν™μ„±ν™” κ²€μ¦
if [ -z "$VIRTUAL_ENV" ]; then
    echo "β κ°€μƒν™κ²½μ΄ ν™μ„±ν™”λμ§€ μ•μ•μµλ‹λ‹¤!"
    exit 1
fi

# Python κ²½λ΅ ν™•μΈ λ° μ„¤μ •
export PYTHONPATH="${PWD}:${PYTHONPATH}"

# κ°€μƒν™κ²½ Python κ°•μ  μ‚¬μ©
export PYTHON_BIN="${VIRTUAL_ENV}/bin/python"
export PIP_BIN="${VIRTUAL_ENV}/bin/pip"

# κ°λ° ν™κ²½ λ³€μ λ΅λ“
if [ -f ".env.development" ]; then
    set -a
    source .env.development
    set +a
    echo "π“‹ κ°λ°ν™κ²½ μ„¤μ • λ΅λ“μ™„λ£"
fi

# Poetry κ°€μƒν™κ²½ κ²½λ΅ ν™•μΈ
if command -v poetry >/dev/null 2>&1; then
    export POETRY_VENV_PATH=$(poetry env info --path 2>/dev/null || echo "")
fi

# scripts λ””λ ‰ν† λ¦¬λ¥Ό PATHμ— μ¶”κ°€
export PATH="${PWD}/scripts:${PATH}"

echo "β… κ°λ°ν™κ²½ μ¤€λΉ„ μ™„λ£! 'help' λ…λ Ήμ–΄λ΅ μ‚¬μ©λ²•μ„ ν™•μΈν•μ„Έμ”."